<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงูุชูุงุฑูุฑ - ูุธุงู ุงููุดู ุงููุจูุฑ ุนู ุงูุฑููุงุชููุฏ</title>
    <link rel="stylesheet" href="frontend/css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-brand">
                <span class="icon">๐ฅ</span>
                <span>ูุธุงู ุงููุดู ุงููุจูุฑ ุนู ุงูุฑููุงุชููุฏ</span>
            </div>
            <ul class="navbar-menu">
                <li><a href="index.html">ุงูุฑุฆูุณูุฉ</a></li>
                <li><a href="patients.html">ุงููุฑุถู</a></li>
                <li><a href="analytics.html">ุงูุชุญูููุงุช</a></li>
                <li><a href="reports.html" class="active">ุงูุชูุงุฑูุฑ</a></li>
            </ul>
            <div class="navbar-actions">
                <div class="notification-badge" onclick="showNotifications()">
                    <span style="font-size: 1.5rem; cursor: pointer;">๐</span>
                    <span class="badge" id="notificationCount">2</span>
                </div>
            </div>
        </div>
    </nav>

    <div class="main-container">
        <div class="page-header">
            <h1>๐ ุงูุชูุงุฑูุฑ ุงูุทุจูุฉ</h1>
            <p>ุฅูุดุงุก ูุนุฑุถ ุงูุชูุงุฑูุฑ ุงูุทุจูุฉ ุงูุดุงููุฉ</p>
        </div>

        <div class="dashboard-grid" style="margin-bottom: 2rem;">
            <div class="card clickable" onclick="generateReport('patient')">
                <div class="card-body" style="text-align: center; padding: 2rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">๐ค</div>
                    <h3>ุชูุฑูุฑ ูุฑูุถ</h3>
                    <p style="color: var(--text-secondary); margin-top: 0.5rem;">ุชูุฑูุฑ ุดุงูู ูุญุงูุฉ ูุฑูุถ ูุญุฏุฏ</p>
                </div>
            </div>

            <div class="card clickable" onclick="generateReport('monthly')">
                <div class="card-body" style="text-align: center; padding: 2rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">๐</div>
                    <h3>ุชูุฑูุฑ ุดูุฑู</h3>
                    <p style="color: var(--text-secondary); margin-top: 0.5rem;">ููุฎุต ุดูุฑู ูุฌููุน ุงูุญุงูุงุช</p>
                </div>
            </div>

            <div class="card clickable" onclick="generateReport('statistics')">
                <div class="card-body" style="text-align: center; padding: 2rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">๐</div>
                    <h3>ุชูุฑูุฑ ุฅุญุตุงุฆู</h3>
                    <p style="color: var(--text-secondary); margin-top: 0.5rem;">ุชุญูููุงุช ูุฅุญุตุงุฆูุงุช ููุตูุฉ</p>
                </div>
            </div>

            <div class="card clickable" onclick="generateReport('highrisk')">
                <div class="card-body" style="text-align: center; padding: 2rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">โ๏ธ</div>
                    <h3>ุญุงูุงุช ุนุงููุฉ ุงูุฎุทูุฑุฉ</h3>
                    <p style="color: var(--text-secondary); margin-top: 0.5rem;">ุชูุฑูุฑ ุจุงูุญุงูุงุช ุงูุญุฑุฌุฉ</p>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2 class="card-title">ุงูุชูุงุฑูุฑ ุงูุฃุฎูุฑุฉ</h2>
                <button class="btn btn-primary" onclick="showNewReportModal()">โ ุชูุฑูุฑ ุฌุฏูุฏ</button>
            </div>
            <div class="card-body" style="padding: 0;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ููุน ุงูุชูุฑูุฑ</th>
                            <th>ุงูุชุงุฑูุฎ</th>
                            <th>ุงููุชุฑุฉ</th>
                            <th>ุนุฏุฏ ุงูุญุงูุงุช</th>
                            <th>ุงูุญุงูุฉ</th>
                            <th>ุงูุฅุฌุฑุงุกุงุช</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>๐ ุชูุฑูุฑ ุฅุญุตุงุฆู</strong></td>
                            <td>2024-10-28</td>
                            <td>ุฃูุชูุจุฑ 2024</td>
                            <td>5 ูุฑุถู</td>
                            <td><span class="badge badge-success">ููุชูู</span></td>
                            <td>
                                <button class="btn btn-sm btn-primary" onclick="viewReport(1)">๐๏ธ ุนุฑุถ</button>
                                <button class="btn btn-sm btn-secondary" onclick="downloadReport(1)">๐ฅ ุชุญููู</button>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>โ๏ธ ุญุงูุงุช ุนุงููุฉ ุงูุฎุทูุฑุฉ</strong></td>
                            <td>2024-10-25</td>
                            <td>ุฃูุชูุจุฑ 2024</td>
                            <td>2 ูุฑุถู</td>
                            <td><span class="badge badge-success">ููุชูู</span></td>
                            <td>
                                <button class="btn btn-sm btn-primary" onclick="viewReport(2)">๐๏ธ ุนุฑุถ</button>
                                <button class="btn btn-sm btn-secondary" onclick="downloadReport(2)">๐ฅ ุชุญููู</button>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>๐ ุชูุฑูุฑ ุดูุฑู</strong></td>
                            <td>2024-10-01</td>
                            <td>ุณุจุชูุจุฑ 2024</td>
                            <td>4 ูุฑุถู</td>
                            <td><span class="badge badge-success">ููุชูู</span></td>
                            <td>
                                <button class="btn btn-sm btn-primary" onclick="viewReport(3)">๐๏ธ ุนุฑุถ</button>
                                <button class="btn btn-sm btn-secondary" onclick="downloadReport(3)">๐ฅ ุชุญููู</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="reportPreview" class="card" style="margin-top: 2rem; display: none;">
            <div class="card-header">
                <h2 class="card-title">ูุนุงููุฉ ุงูุชูุฑูุฑ</h2>
                <button class="btn btn-secondary" onclick="closeReportPreview()">โ ุฅุบูุงู</button>
            </div>
            <div class="card-body" id="reportContent">
            </div>
        </div>
    </div>

    <div id="newReportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>โ ุฅูุดุงุก ุชูุฑูุฑ ุฌุฏูุฏ</h2>
                <button class="modal-close" onclick="closeModal('newReportModal')">ร</button>
            </div>
            <div class="modal-body">
                <form id="newReportForm">
                    <div class="form-group">
                        <label>ููุน ุงูุชูุฑูุฑ *</label>
                        <select id="reportType" required>
                            <option value="">ุงุฎุชุฑ ููุน ุงูุชูุฑูุฑ...</option>
                            <option value="patient">ุชูุฑูุฑ ูุฑูุถ</option>
                            <option value="monthly">ุชูุฑูุฑ ุดูุฑู</option>
                            <option value="statistics">ุชูุฑูุฑ ุฅุญุตุงุฆู</option>
                            <option value="highrisk">ุญุงูุงุช ุนุงููุฉ ุงูุฎุทูุฑุฉ</option>
                        </select>
                    </div>
                    <div class="form-group" id="patientSelectGroup" style="display: none;">
                        <label>ุงุฎุชุฑ ุงููุฑูุถ *</label>
                        <select id="reportPatient">
                            <option value="">ุงุฎุชุฑ ุงููุฑูุถ...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ุงููุชุฑุฉ ุงูุฒูููุฉ *</label>
                        <select id="reportPeriod" required>
                            <option value="current">ุงูุดูุฑ ุงูุญุงูู</option>
                            <option value="last">ุงูุดูุฑ ุงููุงุถู</option>
                            <option value="quarter">ุขุฎุฑ 3 ุฃุดูุฑ</option>
                            <option value="year">ุขุฎุฑ ุณูุฉ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ุชุถููู</label>
                        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" checked> ุงูุจูุงูุงุช ุงูุณุฑูุฑูุฉ
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" checked> ุงูุฑุณูู ุงูุจูุงููุฉ
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox"> ุงูุตูุฑ ุงูุทุจูุฉ
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox"> ุงูุชูุตูุงุช ุงูุทุจูุฉ
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('newReportModal')">ุฅูุบุงุก</button>
                <button class="btn btn-primary" onclick="createReport()">๐ ุฅูุดุงุก ุงูุชูุฑูุฑ</button>
            </div>
        </div>
    </div>

    <div id="notificationsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>๐ ุงูุชูุจููุงุช</h2>
                <button class="modal-close" onclick="closeModal('notificationsModal')">ร</button>
            </div>
            <div class="modal-body" id="notificationsContent">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="frontend/js/mock-data.js"></script>
    <script src="frontend/js/api.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            await loadPatientsList();
            await updateNotificationCount();
        });

        async function loadPatientsList() {
            const response = await API.getPatients();
            const patients = response.data;
            
            const select = document.getElementById('reportPatient');
            select.innerHTML = '<option value="">ุงุฎุชุฑ ุงููุฑูุถ...</option>' + 
                patients.map(p => `<option value="${p.id}">${p.name}</option>`).join('');
        }

        function generateReport(type) {
            document.getElementById('reportType').value = type;
            showNewReportModal();
        }

        function showNewReportModal() {
            document.getElementById('newReportModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        document.getElementById('reportType')?.addEventListener('change', function() {
            const patientGroup = document.getElementById('patientSelectGroup');
            if (this.value === 'patient') {
                patientGroup.style.display = 'block';
            } else {
                patientGroup.style.display = 'none';
            }
        });

        async function createReport() {
            const type = document.getElementById('reportType').value;
            const period = document.getElementById('reportPeriod').value;
            
            if (!type) {
                alert('ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ููุน ุงูุชูุฑูุฑ');
                return;
            }

            closeModal('newReportModal');
            alert('ุฌุงุฑู ุฅูุดุงุก ุงูุชูุฑูุฑ... ุณูุชู ุฅุดุนุงุฑู ุนูุฏ ุงูุงูุชูุงุก');
            
            setTimeout(() => {
                alert('โ ุชู ุฅูุดุงุก ุงูุชูุฑูุฑ ุจูุฌุงุญ!');
                location.reload();
            }, 2000);
        }

        function viewReport(reportId) {
            const preview = document.getElementById('reportPreview');
            const content = document.getElementById('reportContent');
            
            content.innerHTML = `
                <div style="padding: 2rem;">
                    <h2 style="text-align: center; margin-bottom: 2rem;">ุชูุฑูุฑ ุฅุญุตุงุฆู - ุฃูุชูุจุฑ 2024</h2>
                    
                    <div style="margin-bottom: 2rem;">
                        <h3>ููุฎุต ุชูููุฐู</h3>
                        <p>ุชู ุชุณุฌูู 5 ูุฑุถู ุฌุฏุฏ ุฎูุงู ุดูุฑ ุฃูุชูุจุฑ 2024ุ ูููู 2 ุญุงูุฉ ุนุงููุฉ ุงูุฎุทูุฑุฉ ุชุญุชุงุฌ ููุชุงุจุนุฉ ุฏูููุฉ.</p>
                    </div>

                    <div style="margin-bottom: 2rem;">
                        <h3>ุงูุฅุญุตุงุฆูุงุช ุงูุฑุฆูุณูุฉ</h3>
                        <ul>
                            <li>ุฅุฌูุงูู ุงููุฑุถู: 5</li>
                            <li>ุญุงูุงุช ุนุงููุฉ ุงูุฎุทูุฑุฉ: 2 (40%)</li>
                            <li>ุญุงูุงุช ูุชูุณุทุฉ ุงูุฎุทูุฑุฉ: 2 (40%)</li>
                            <li>ุญุงูุงุช ููุฎูุถุฉ ุงูุฎุทูุฑุฉ: 1 (20%)</li>
                        </ul>
                    </div>

                    <div style="margin-bottom: 2rem;">
                        <h3>ุงูุชูุตูุงุช</h3>
                        <ul>
                            <li>ูุชุงุจุนุฉ ุฏูุฑูุฉ ููุญุงูุงุช ุนุงููุฉ ุงูุฎุทูุฑุฉ ูู ุฃุณุจูุนูู</li>
                            <li>ุฅุฌุฑุงุก ุชุญุงููู ุดุงููุฉ ููุญุงูุงุช ุงูุฌุฏูุฏุฉ</li>
                            <li>ุชุญุฏูุซ ุงูุจุฑูุชููููุงุช ุงูุนูุงุฌูุฉ ุญุณุจ ุขุฎุฑ ุงูุฅุฑุดุงุฏุงุช</li>
                        </ul>
                    </div>

                    <div style="text-align: center; margin-top: 3rem;">
                        <button class="btn btn-primary" onclick="downloadReport(${reportId})">๐ฅ ุชุญููู PDF</button>
                        <button class="btn btn-secondary" onclick="printReport()">๐จ๏ธ ุทุจุงุนุฉ</button>
                    </div>
                </div>
            `;
            
            preview.style.display = 'block';
            preview.scrollIntoView({ behavior: 'smooth' });
        }

        function closeReportPreview() {
            document.getElementById('reportPreview').style.display = 'none';
        }

        function downloadReport(reportId) {
            alert('ุณูุชู ุชุญููู ุงูุชูุฑูุฑ ุจุตูุบุฉ PDF (ูุฑูุจุงู)');
        }

        function printReport() {
            window.print();
        }

        function showNotifications() {
            document.getElementById('notificationsModal').classList.add('active');
            loadNotifications();
        }

        async function loadNotifications() {
            const response = await API.getAlerts();
            const notifications = response.data;
            
            const content = document.getElementById('notificationsContent');
            content.innerHTML = notifications.map(notif => `
                <div class="notification-item ${notif.read ? 'read' : 'unread'}">
                    <div class="notification-icon ${notif.type}">${notif.type === 'warning' ? 'โ๏ธ' : notif.type === 'info' ? 'โน๏ธ' : 'โ'}</div>
                    <div class="notification-content">
                        <h4>${notif.title}</h4>
                        <p>${notif.message}</p>
                        <small>${new Date(notif.date).toLocaleString('ar-SA')}</small>
                    </div>
                </div>
            `).join('');
        }

        async function updateNotificationCount() {
            const response = await API.getAlerts();
            const unreadCount = response.data.filter(n => !n.read).length;
            document.getElementById('notificationCount').textContent = unreadCount;
        }
    </script>

    <style>
        .clickable {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .clickable:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
    </style>
</body>
</html>
