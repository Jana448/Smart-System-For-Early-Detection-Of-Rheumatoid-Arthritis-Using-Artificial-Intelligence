<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงููุฑุถู - ูุธุงู ุงููุดู ุงููุจูุฑ ุนู ุงูุฑููุงุชููุฏ</title>
    <link rel="stylesheet" href="frontend/css/style.css">
</head>
<body>
    
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-brand">
                <span class="icon">๐ฅ</span>
                <span>ูุธุงู ุงููุดู ุงููุจูุฑ ุนู ุงูุฑููุงุชููุฏ</span>
            </div>
            <ul class="navbar-menu">
                <li><a href="index.html">ุงูุฑุฆูุณูุฉ</a></li>
                <li><a href="patients.html" class="active">ุงููุฑุถู</a></li>
                <li><a href="analytics.html">ุงูุชุญูููุงุช</a></li>
                <li><a href="reports.html">ุงูุชูุงุฑูุฑ</a></li>
            </ul>
            <div class="navbar-actions">
                <div class="notification-badge" onclick="showNotifications()">
                    <span style="font-size: 1.5rem; cursor: pointer;">๐</span>
                    <span class="badge" id="notificationCount">2</span>
                </div>
                <button class="btn btn-primary" onclick="showAddPatientModal()">โ ุฅุถุงูุฉ ูุฑูุถ</button>
            </div>
        </div>
    </nav>

    <div class="main-container">
        <div class="page-header">
            <h1>๐ฅ ุฅุฏุงุฑุฉ ุงููุฑุถู</h1>
            <p>ุนุฑุถ ูุฅุฏุงุฑุฉ ุฌููุน ุงููุฑุถู ุงููุณุฌููู ูู ุงููุธุงู</p>
        </div>

        <div class="card" style="margin-bottom: 2rem;">
            <div class="card-body">
                <div style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: center;">
                    <input type="text" id="searchPatients" placeholder="๐ ุจุญุซ ุจุงูุงุณูุ ุงูุฑููุ ุฃู ุงููุงุชู..." 
                           style="flex: 1; min-width: 250px; padding: 0.75rem 1rem; border: 1px solid var(--border-color); border-radius: var(--radius-md);">
                    
                    <select id="filterRisk" style="padding: 0.75rem 1rem; border: 1px solid var(--border-color); border-radius: var(--radius-md);">
                        <option value="">ุฌููุน ุงููุณุชููุงุช</option>
                        <option value="high">ุฎุทุฑ ุนุงูู</option>
                        <option value="medium">ุฎุทุฑ ูุชูุณุท</option>
                        <option value="low">ุฎุทุฑ ููุฎูุถ</option>
                    </select>
                    
                    <select id="filterStatus" style="padding: 0.75rem 1rem; border: 1px solid var(--border-color); border-radius: var(--radius-md);">
                        <option value="">ุฌููุน ุงูุญุงูุงุช</option>
                        <option value="active">ูุดุท</option>
                        <option value="inactive">ุบูุฑ ูุดุท</option>
                    </select>
                    
                    <button class="btn btn-secondary" onclick="refreshPatients()">๐ ุชุญุฏูุซ</button>
                </div>
            </div>
        </div>

        <div class="stats-grid" style="margin-bottom: 2rem;">
            <div class="stat-card primary">
                <div class="stat-card-header">
                    <span class="stat-card-title">ุฅุฌูุงูู ุงููุฑุถู</span>
                    <div class="stat-card-icon">๐ฅ</div>
                </div>
                <div class="stat-card-value" id="totalPatientsCount">10</div>
                <div class="stat-card-change positive">
                    <span>โ 12%</span>
                    <span>ุนู ุงูุดูุฑ ุงููุงุถู</span>
                </div>
            </div>

            <div class="stat-card danger">
                <div class="stat-card-header">
                    <span class="stat-card-title">ุฎุทุฑ ุนุงูู</span>
                    <div class="stat-card-icon">โ๏ธ</div>
                </div>
                <div class="stat-card-value" id="highRiskCount">3</div>
                <div class="stat-card-change negative">
                    <span>โ 5%</span>
                    <span>ูุญุชุงุฌ ูุชุงุจุนุฉ</span>
                </div>
            </div>

            <div class="stat-card warning">
                <div class="stat-card-header">
                    <span class="stat-card-title">ุฎุทุฑ ูุชูุณุท</span>
                    <div class="stat-card-icon">โก</div>
                </div>
                <div class="stat-card-value" id="mediumRiskCount">4</div>
                <div class="stat-card-change">
                    <span>โ 0%</span>
                    <span>ูุณุชูุฑ</span>
                </div>
            </div>

            <div class="stat-card success">
                <div class="stat-card-header">
                    <span class="stat-card-title">ุฎุทุฑ ููุฎูุถ</span>
                    <div class="stat-card-icon">โ</div>
                </div>
                <div class="stat-card-value" id="lowRiskCount">3</div>
                <div class="stat-card-change positive">
                    <span>โ 8%</span>
                    <span>ุชุญุณู ููุญูุธ</span>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2 class="card-title">ูุงุฆูุฉ ุงููุฑุถู</h2>
            </div>
            <div class="card-body" style="padding: 0;">
                <div class="table-wrapper">
                    <div style="text-align: center; padding: 2rem;">
                        <div class="loading"><div class="spinner"></div></div>
                        <p style="margin-top: 1rem; color: var(--text-secondary);">ุฌุงุฑู ุชุญููู ุงููุฑุถู...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="addPatientModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>โ ุฅุถุงูุฉ ูุฑูุถ ุฌุฏูุฏ</h2>
                <button class="modal-close" onclick="closeModal('addPatientModal')">ร</button>
            </div>
            <div class="modal-body">
                <form id="addPatientForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>ุงูุงุณู ุงููุงูู *</label>
                            <input type="text" id="patientName" required>
                        </div>
                        <div class="form-group">
                            <label>ุงูุนูุฑ *</label>
                            <input type="number" id="patientAge" min="1" max="120" required>
                        </div>
                        <div class="form-group">
                            <label>ุงูุฌูุณ *</label>
                            <select id="patientGender" required>
                                <option value="">ุงุฎุชุฑ...</option>
                                <option value="ุฐูุฑ">ุฐูุฑ</option>
                                <option value="ุฃูุซู">ุฃูุซู</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ุฑูู ุงููุงุชู *</label>
                            <input type="tel" id="patientPhone" required>
                        </div>
                        <div class="form-group">
                            <label>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
                            <input type="email" id="patientEmail">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addPatientModal')">ุฅูุบุงุก</button>
                <button class="btn btn-primary" onclick="submitAddPatient()">๐พ ุญูุธ</button>
            </div>
        </div>
    </div>

    <div id="notificationsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>๐ ุงูุชูุจููุงุช</h2>
                <button class="modal-close" onclick="closeModal('notificationsModal')">ร</button>
            </div>
            <div class="modal-body" id="notificationsContent">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="frontend/js/mock-data.js"></script>
    <script src="frontend/js/api.js"></script>
    <script src="frontend/js/patients.js"></script>
    
    <script>
        
        function showNotifications() {
            document.getElementById('notificationsModal').classList.add('active');
            loadNotifications();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function showAddPatientModal() {
            document.getElementById('addPatientModal').classList.add('active');
        }

        async function submitAddPatient() {
            try {
                const form = document.getElementById('addPatientForm');
                const name = document.getElementById('patientName').value;
                const age = document.getElementById('patientAge').value;
                const gender = document.getElementById('patientGender').value;
                const phone = document.getElementById('patientPhone').value;
                const email = document.getElementById('patientEmail').value;

                if (!name || !age || !gender || !phone) {
                    alert('ุงูุฑุฌุงุก ููุก ุฌููุน ุงูุญููู ุงููุทููุจุฉ');
                    return;
                }

                const patientData = {
                    name: name,
                    age: parseInt(age),
                    gender: gender,
                    phone: phone,
                    email: email
                };

                const response = await API.addPatient(patientData);
                
                if (response.success) {
                    alert('ุชู ุฅุถุงูุฉ ุงููุฑูุถ ุจูุฌุงุญ');
                    closeModal('addPatientModal');
                    form.reset();
                    refreshPatients();
                }
            } catch (error) {
                alert('ุญุฏุซ ุฎุทุฃ: ' + error.message);
            }
        }

        async function loadNotifications() {
            const response = await API.getAlerts();
            const notifications = response.data;
            
            const content = document.getElementById('notificationsContent');
            content.innerHTML = notifications.map(notif => `
                <div class="notification-item ${notif.read ? 'read' : 'unread'}">
                    <div class="notification-icon ${notif.type}">${notif.type === 'warning' ? 'โ๏ธ' : notif.type === 'info' ? 'โน๏ธ' : 'โ'}</div>
                    <div class="notification-content">
                        <h4>${notif.title}</h4>
                        <p>${notif.message}</p>
                        <small>${new Date(notif.date).toLocaleString('ar-SA')}</small>
                    </div>
                </div>
            `).join('');
        }

        document.addEventListener('DOMContentLoaded', async function() {
            try {
                const response = await API.getAlerts();
                const unreadCount = response.data.filter(n => !n.read).length;
                document.getElementById('notificationCount').textContent = unreadCount;
            } catch (error) {
                console.log('ุชุนุฐุฑ ุชุญููู ุงูุชูุจููุงุช');
            }
        });
    </script>
</body>
</html>
